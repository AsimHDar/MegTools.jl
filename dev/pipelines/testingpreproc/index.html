<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple Pipeline · MegTools.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MegTools.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../functions/">DocStrings</a></li><li class="is-active"><a class="tocitem" href>Simple Pipeline</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Pipeline-with-single-subject-(all-conditions)-1"><span>Pipeline with single subject (all conditions)</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Simple Pipeline</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple Pipeline</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ElectronicTeaCup/MegTools.jl/blob/master/docs/src/pipelines/testingpreproc.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Simple-pipeline-1"><a class="docs-heading-anchor" href="#Simple-pipeline-1">Simple pipeline</a><a class="docs-heading-anchor-permalink" href="#Simple-pipeline-1" title="Permalink"></a></h1><p>Loading a single condition from subject where epoch data was extracted via BESA®. In This example we use some more plausible data than the test data</p><pre><code class="language-julia">using Plots
gr()
using Measures
using MegTools
test = load_cont_epochs(&quot;condEpoch.mat&quot;)</code></pre><pre><code class="language-none">Dict{Any,Any} with 4 entries:
  &quot;4&quot; =&gt; [showing 3 of 100 slices]…
  &quot;1&quot; =&gt; [showing 3 of 100 slices]…
  &quot;2&quot; =&gt; [showing 3 of 100 slices]…
  &quot;3&quot; =&gt; [showing 3 of 100 slices]…</code></pre><p>The data from condition &quot;2&quot; (defined in BESA®) is averaged across all the trials</p><pre><code class="language-julia">test_average = average_across_trials(test[&quot;2&quot;])</code></pre><pre><code class="language-none">2-dimensional KeyedArray(NamedDimsArray(...)) with keys:
↓   time ∈ 1501-element Vector{Float64}
→   channels ∈ 319-element Vector{Symbol}
And data, 1501×319 Array{Float64,2}:
           (:MEG0112)  (:MEG0113)  …  (:IAS_Y)   (:IAS_z)   (:SYS201)
 (-500.0)   2.56249    21.5772        -0.655651  -0.417233   0.0     
 (-499.0)   3.12303    19.4094        -0.691414  -0.405312   0.0     
 (-498.0)   2.1424     13.8768        -0.679493  -0.321865   0.0     
 (-497.0)   1.7165     13.7295        -0.679493  -0.286102   0.0     
 (-496.0)   2.72797    15.3495     …  -0.715256  -0.309944   0.0     
 (-495.0)   1.81067    19.3068        -0.667572  -0.286102   0.0     
      ⋮                            ⋱                                 
  (994.0)   2.70243    -1.72295       -0.667572  -0.429153   0.0     
  (995.0)  -0.983829   -0.0452927     -0.691414  -0.38147    0.0     
  (996.0)  -4.31213     1.7537     …  -0.691414  -0.405312   0.0     
  (997.0)  -4.86396     3.63506       -0.64373   -0.405312   0.0     
  (998.0)  -3.68522     4.85062       -0.667572  -0.452995   0.0     
  (999.0)  -5.28816     5.96115       -0.619888  -0.405312   0.0     
 (1000.0)  -4.48724     4.85557       -0.64373   -0.429153   0.0</code></pre><p>We select data that we&#39;re interested in: in this case the pre-defined auditoryN1m channels and take a look at the averaged waveforms from the selected channels.</p><pre><code class="language-julia">test_average_auditory,auditory_left,auditory_right = select_channels(
    test_average,
    paradigm=&quot;auditoryN1m&quot;,
)

plot(test_average_auditory, legend=false, size=(1000,500))</code></pre><p><img src="../figures/testingpreproc_3_1.png" alt/></p><p>Applying filters to smoothen out the waveform</p><pre><code class="language-julia">filtered = highlow_butterworth_filter(test_average_auditory, 1000)
plot(
    test[&quot;2&quot;].time,
    filtered(channels=:MEG1621),
    label=&quot;Filtered&quot;, size=(1000,500),
    linewidth=3,
    color=:royalblue,
);
plot!(
    test[&quot;2&quot;].time,
    test_average_auditory(channels=:MEG1621),
    label=&quot;Raw&quot;,
    color=:lightblue,
    )</code></pre><p><img src="../figures/testingpreproc_4_1.png" alt/></p><p>Follow up with baseline correction of the data</p><pre><code class="language-julia">baseline_corrected = baseline_correction(filtered)
plot(
  test[&quot;2&quot;].time,
  filtered(channels=:MEG1621),
  label=&quot;Only Filtered&quot;,
  size=(1000,500),
  linewidth=3,
  color=:royalblue,
);
plot!(
    test[&quot;2&quot;].time,
    baseline_corrected(channels=:MEG1621),
    label=&quot;Baseline Corrected&quot;,
    size=(1000,500),
    linewidth=3,
    color=:crimson,
  )</code></pre><p><img src="../figures/testingpreproc_5_1.png" alt/></p><p>And finally finding peaks in both left and right sets of channels</p><pre><code class="language-julia">a,_,b,_,c,d = find_peaks(baseline_corrected, auditory_left, auditory_right)

# Takinga look at all the channels with marked peak values
channel_plots = plot(layout=(9,3), size = (1000,3000), margin=5mm, legend=false, ticks=[])
for channel = 1:26
    plot!(
        channel_plots,
        test_average_auditory[:,channel],
        color=:lightblue,
        subplot=channel,
        label = &quot;Raw Signal&quot;)
    plot!(
        channel_plots,
        filtered[:,channel],
        subplot=channel,
        width=2,
        color=:royalblue,
        label = &quot;filtered Signal&quot;,
    )
    plot!(
        channel_plots,
        baseline_corrected[:,channel],
        subplot=channel,
        color=:crimson,
        width=2, label=&quot;Baseline corrected&quot;,
    )
    if test_average_auditory.channels[channel] == c
        plot!(
        reverse(findmax(baseline_corrected[:,channel])),
        seriestype=:scatter,
        subplot=channel,
        color=:green,
        label=&quot;Peak left hem&quot;, markersize=8,
    )
    elseif test_average_auditory.channels[channel] == d
        plot!(
            reverse(findmin(baseline_corrected[:,channel])),
            seriestype=:scatter,
            subplot=channel,
            color=:red,
            label=&quot;Peak right hem&quot;,
            markersize=8
        )
    end

end


channel_plots</code></pre><p><img src="../figures/testingpreproc_6_1.png" alt/></p><h1 id="Pipeline-with-single-subject-(all-conditions)-1"><a class="docs-heading-anchor" href="#Pipeline-with-single-subject-(all-conditions)-1">Pipeline with single subject (all conditions)</a><a class="docs-heading-anchor-permalink" href="#Pipeline-with-single-subject-(all-conditions)-1" title="Permalink"></a></h1><p>Loading the data we need. This time an entire subject is selected, rather than a single condition.</p><pre><code class="language-julia">using Plots
gr()
using Measures
using MegTools
test = load_cont_epochs(&quot;condEpoch.mat&quot;)

test_average = average_across_trials(test)</code></pre><pre><code class="language-none">Dict{Any,Any} with 4 entries:
  &quot;4&quot; =&gt; [-10.4638 -2.82368 … -0.345707 0.0; -10.8853 -4.47701 … -0.441074
0.0;…
  &quot;1&quot; =&gt; [-5.28188 -6.96084 … -0.345707 0.0; -3.12151 -9.73671 … -0.393391
0.0;…
  &quot;2&quot; =&gt; [2.56249 21.5772 … -0.417233 0.0; 3.12303 19.4094 … -0.405312 0.0;
 … ;…
  &quot;3&quot; =&gt; [-8.77625 -1.33373 … -0.357628 0.0; -6.94149 -3.89193 … -0.369549
0.0;…</code></pre><p>Getting the averages of all conditions</p><pre><code class="language-julia">test_average_auditory,auditory_left,auditory_right = select_channels(
    test_average,
    paradigm=&quot;auditoryN1m&quot;,
)

avs = plot(layout=(4,1), size=(1000,1000))
for (cond,val) in test_average_auditory
    plot!(avs, test_average_auditory[cond], legend=false)
end

avs</code></pre><p><img src="../figures/testingsubjectAnalysis_2_1.png" alt/></p><p>Filtering and baseline correcting</p><pre><code class="language-julia">filtered = highlow_butterworth_filter(test_average_auditory, 1000)
baseline_corrected = baseline_correction(filtered)

peaks = find_peaks(baseline_corrected, auditory_left, auditory_right)</code></pre><pre><code class="language-none">Dict{Any,Any} with 4 entries:
  &quot;4&quot; =&gt; Dict{Any,Any}(&quot;right_channel_label&quot;=&gt;:MEG2221,&quot;left_peak_value&quot;=&gt;2
49.1…
  &quot;1&quot; =&gt; Dict{Any,Any}(&quot;right_channel_label&quot;=&gt;:MEG2611,&quot;left_peak_value&quot;=&gt;9
1.75…
  &quot;2&quot; =&gt; Dict{Any,Any}(&quot;right_channel_label&quot;=&gt;:MEG2221,&quot;left_peak_value&quot;=&gt;1
67.5…
  &quot;3&quot; =&gt; Dict{Any,Any}(&quot;right_channel_label&quot;=&gt;:MEG2221,&quot;left_peak_value&quot;=&gt;2
22.7…</code></pre><p>Loading trigger values from labels</p><pre><code class="language-julia">cond_trigger_vals = load_trigger_values(&quot;regsoi&quot;)</code></pre><pre><code class="language-none">Dict{String,Any} with 20 entries:
  &quot;4&quot;  =&gt; 0.5
  &quot;1&quot;  =&gt; 1.0
  &quot;12&quot; =&gt; 1.4
  &quot;20&quot; =&gt; &quot;Noise&quot;
  &quot;2&quot;  =&gt; 0.3
  &quot;6&quot;  =&gt; 0.7
  &quot;11&quot; =&gt; 1.3
  &quot;13&quot; =&gt; 1.5
  &quot;5&quot;  =&gt; 0.6
  &quot;15&quot; =&gt; 1.7
  &quot;16&quot; =&gt; 1.8
  &quot;14&quot; =&gt; 1.6
  &quot;7&quot;  =&gt; 0.8
  &quot;8&quot;  =&gt; 0.9
  &quot;17&quot; =&gt; 1.9
  &quot;10&quot; =&gt; 1.2
  &quot;19&quot; =&gt; 1.001
  &quot;9&quot;  =&gt; 1.1
  &quot;18&quot; =&gt; 2.0
  &quot;3&quot;  =&gt; 0.4</code></pre><p>For this specific analysis I need the peaks from all averaged and preprocecced ERFS</p><pre><code class="language-julia">soi, left_amps, right_amps = collect_peaks(peaks)</code></pre><pre><code class="language-none">(Any[0.3, 0.4, 0.5, 1.0], Any[167.54163255378427, 222.76169962748236, 249.1
7313020699214, 91.75092170883264], Any[164.4568309644351, 227.3254603109246
3, 244.7908937654169, 120.45757339145912])</code></pre><p>Plotting peaks that we got</p><pre><code class="language-julia">scatter(soi,left_amps, label=&quot;Left peak amplitudes&quot;);
scatter!(soi,right_amps, label=&quot;Right peak amplitudes&quot;)</code></pre><p><img src="../figures/testingsubjectAnalysis_6_1.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../functions/">« DocStrings</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 6 October 2020 13:18">Tuesday 6 October 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
